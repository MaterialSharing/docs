## 创建数据库时的考虑



- 将不同考试类型的词汇大纲怎么处理

  - 放在不同表

    - 字段最少(结构最简单)
    - 但是需要管理的表数量变多,而且结构重复,编写接口的时候有一定重复

  - 放在一张表

    - 为每个单词增加字段
      - 一个字段
        - 多个值:一个单词可能属于多个考试考纲中的词汇)(4,6,8,46,68,...)
        - 字段单个值,拆分为多条记录:在一条记录的同一个字段有个取值时,将其拆分为多条记录加以存放
      - 多个字段:
        - 分别设置cet4/cet6/neep字段,如果某个单词属于该字段,那么为其取bool值true(1)

    > - 主属性采用原主键+多值的那个字段构成多字段主键

  - 收藏表和搜索记录表是否分开放

    - 两个表结构相似
  - 但是考虑到各自的可独立扩展性,本项目将其拆分



> 基于如下考虑,我决定不拆分word表(将词形(诸如past tense/presentParticiple/pastParticiple))从而提高查询效率



-  复杂表的优缺点

  - 优点：包含全部字段的表，在查询时避免了连表查询，程序处理起来比方便，有时候某些表会加进一些冗余字段，也就是为了避免连表查询。查询的效率方面有优势。

  -  缺点：如果字段里面有大字段（text,blob)类型的，而且这些字段的访问并不多，这时候放在一起就变成缺点了。 

- 简单表(字段简单的表)

  - 更可能符合更高的范式

  - MYSQL数据库的记录存储是按行存储的，数据块大小又是固定的（16K），**每条记录越小**，存储块内存储的记录就越多。此时应该把大字段拆走，这样**应付大部分小字段的查询时，就能提高效率**。

  - 当需要查询大字段时，此时的关联查询是不可避免的，但也是值得的。

  - 拆分开后，对字段的UPDATE就要UPDATE多个表了

  - 用于查询和展示的 不建议分表， 

  - 若只是存储数据，可以考虑分表。

  

## User用户模块



### 用户表

\![image-20220604160924400](https://s2.loli.net/2022/06/04/EjDpu7TSYJqMiF8.png

```sql
+---------------+--------------+------+-----+---------+----------------+
| Field         | Type         | Null | Key | Default | Extra          |
+---------------+--------------+------+-----+---------+----------------+
| uid           | int(11)      | NO   | PRI | NULL    | auto_increment |
| name          | varchar(250) | NO   |     | NULL    |                |
| signIn        | int(11)      | NO   |     | NULL    |                |
| examType      | varchar(1)   | NO   |     | NULL    |                |
| examDate      | date         | NO   |     | NULL    |                |
| signUpDate    | date         | NO   |     | NULL    |                |
| openid        | varchar(150) | YES  | UNI | NULL    |                |
| password_hash | varchar(250) | NO   |     | NULL    |                |
| password_salt | varchar(250) | NO   |     | NULL    |                |
| status        | int(11)      | NO   |     | NULL    |                |
| schedule      | int(11)      | NO   |     | NULL    |                |
+---------------+--------------+------+-----+---------+----------------+
11 rows in set
```

### 查词记录

```sql
+----------+-------------+------+-----+---------+----------------+
| Field    | Type        | Null | Key | Default | Extra          |
+----------+-------------+------+-----+---------+----------------+
| id       | bigint(20)  | NO   | PRI | NULL    | auto_increment |
| spelling | varchar(25) | NO   |     | NULL    |                |
| user_id  | int(11)     | NO   | MUL | NULL    |                |
+----------+-------------+------+-----+---------+----------------+
3 rows in set
```

### 单词收藏表

```sql
+----------+-------------+------+-----+---------+----------------+
| Field    | Type        | Null | Key | Default | Extra          |
+----------+-------------+------+-----+---------+----------------+
| id       | bigint(20)  | NO   | PRI | NULL    | auto_increment |
| spelling | varchar(25) | NO   |     | NULL    |                |
| user_id  | int(11)     | NO   | MUL | NULL    |                |
+----------+-------------+------+-----+---------+----------------+
3 rows in set
```



### 反馈表

- 由于不是所有用户都会做反馈,为了减少冗余,我们将反馈表单独拆分出来

```sql
root@localhost [Sat Jun  4 20:56:41 2022 23 ela4]> desc feed_back;
+---------+--------------+------+-----+---------+----------------+
| Field   | Type         | Null | Key | Default | Extra          |
+---------+--------------+------+-----+---------+----------------+
| id      | bigint(20)   | NO   | PRI | NULL    | auto_increment |
| content | varchar(255) | NO   |     | NULL    |                |
| date    | datetime(6)  | NO   |     | NULL    |                |
| user_id | int(11)      | NO   | MUL | NULL    |                |
+---------+--------------+------+-----+---------+----------------+
4 rows in set
```





## words(词典/记单词模块)模块

### 单词表的设计

* 以操作四级词汇为例

* ```sql
  +--------------------+--------------+------+-----+---------+----------------+
  | Field              | Type         | Null | Key | Default | Extra          |
  +--------------------+--------------+------+-----+---------+----------------+
  | wid                | int(11)      | NO   | PRI | NULL    | auto_increment |
  | spelling           | varchar(255) | NO   |     | NULL    |                |
  | phonetic           | varchar(255) | YES  |     | NULL    |                |
  | plurality          | varchar(255) | YES  |     | NULL    |                |
  | thirdpp            | varchar(255) | YES  |     | NULL    |                |
  | present_participle | varchar(255) | YES  |     | NULL    |                |
  | past_tense         | varchar(255) | YES  |     | NULL    |                |
  | past_participle    | varchar(255) | YES  |     | NULL    |                |
  | explains           | longtext     | YES  |     | NULL    |                |
  +--------------------+--------------+------+-----+---------+----------------+
  9 rows in set (0.32 sec)
  ```


### 词典拼写分析( word_matcher)

```sql
+--------------+--------------+------+-----+---------+----------------+
| Field        | Type         | Null | Key | Default | Extra          |
+--------------+--------------+------+-----+---------+----------------+
| id           | bigint(20)   | NO   | PRI | NULL    | auto_increment |
| spelling     | varchar(255) | NO   |     | NULL    |                |
| char_set_str | varchar(26)  | NO   |     | NULL    |                |
+--------------+--------------+------+-----+---------+----------------+
3 rows
```

- 辅助模糊匹配算法的实现



### 单词批注

```sql
+-----------------+--------------+------+-----+---------+----------------+
| Field           | Type         | Null | Key | Default | Extra          |
+-----------------+--------------+------+-----+---------+----------------+
| id              | bigint(20)   | NO   | PRI | NULL    | auto_increment |
| content         | varchar(255) | YES  |     | NULL    |                |
| spelling        | varchar(255) | YES  |     | NULL    |                |
| UID             | int(11)      | YES  |     | NULL    |                |
+-----------------+--------------+------+-----+---------+----------------+
5 rows in set
```

> - 原本想要使用一个`difficalty_rate`难度投票字段,来丰富用户的交互,但是后来发现这样不靠谱,
> - 遂采用后台统计的平均熟练度来表征应该更为准确.

### 词汇大纲表

> - 在单词(释义)表(词典)之外,我们另外建立了考试大纲词汇的索引数据库(大纲单词索引)
> - 有三张表使用了相同的结构
>

```sql
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| wordOrder | int(11)      | NO   | PRI | NULL    | auto_increment |
| spelling  | varchar(255) | NO   |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
2 rows in set
```

- 字段wordOrder用来充当该表的主键
- 原本打算使用spelling直接作为主键,然而,mysql默认不区分大小写,会导致某些词汇发生冲突;
  - 虽然可以配置mysql强制区分大小写,但是Django文档指出,这可能会引发意料之外的问题,故采用了需要来作为主键

#### 词汇大纲要不要融入到和字典表来减少表的数量?

- 当一个请求需要到来,我们根据需要快速得到相应的单词(spelling),我们就可以拿着这个key去单词词典表里头去查对应拼写的单词的释义等信息
- 这样,即使考纲发生编话,我们需要变动的表也就是四级单词索引表

## scoreImprover(复习提分)

### 学习记录表

> 本表将所有用户的所有考试类型的学习记录都整合起来,方便管理和分析数据

```sql
+-------------------+-------------+------+-----+---------+----------------+
| Field             | Type        | Null | Key | Default | Extra          |
+-------------------+-------------+------+-----+---------+----------------+
| id                | int(11)     | NO   | PRI | NULL    | auto_increment |
| last_see_datetime | datetime(6) | YES  |     | NULL    |                |
| familiarity       | int(11)     | NO   |     | NULL    |                |
| examType          | varchar(1)  | NO   |     | NULL    |                |
| user_id           | int(11)     | NO   | MUL | NULL    |                |
| wid_id            | int(11)     | NO   | MUL | NULL    |                |
+-------------------+-------------+------+-----+---------+----------------+
6 rows in set (0.17 sec)
```

